import schedule
import time
import threading
from openai import OpenAI
import telebot
import requests  # –î–ª—è —Ä–∞–±–æ—Ç—ã —Å API –Ø–Ω–¥–µ–∫—Å.–î–∑–µ–Ω (–ø—Ä–∏–º–µ—Ä)
import os
from dotenv import load_dotenv

from telegram.ext import Application, MessageHandler, filters, ContextTypes
from telegram import Update
load_dotenv()
bot = telebot.TeleBot(os.getenv('TG-KEY'))
deepseek_api = os.getenv('DeepSeek-Key')
CHAT_ID = os.getenv('TG-ChatId')  # –ö–∞–Ω–∞–ª –∏–ª–∏ –≥—Ä—É–ø–ø–∞

client = OpenAI(
  base_url="https://openrouter.ai/api/v1",
  api_key=deepseek_api,
)


def generate_response(prompt: str) -> str:
    response = client.chat.completions.create(
        model="deepseek/deepseek-r1-0528:free",
        messages=[
            {"role": "system", "content": "You are a helpful assistant"},
            {"role": "user", "content": prompt},
        ],
        stream=False
    )
    return response.choices[0].message.content

def scheduled_task():
    request = (
        """
/// 
–ó–∞–¥–∞—á–∞:
1. –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π –∫–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è –Ø–Ω–¥–µ–∫—Å –î–∑–µ–Ω, —á—Ç–æ–±—ã –æ–Ω –±—ã–ª –ø–æ–ø—É–ª—è—Ä–µ–Ω.
2. –ù–µ –ø—Ä–∏—Å—ã–ª–∞–π —Å–≤–æ–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏, –ø—Ä–∏—à–ª–∏ –≥–æ—Ç–æ–≤—ã–π –∫ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç.
3. –ü—Ä–∏—à–ª–∏ –∫–æ–Ω—Ç–µ–Ω—Ç, —á—Ç–æ–±—ã —É–¥–µ—Ä–∂–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ –∫–∞–Ω–∞–ª–µ –î–∑–µ–Ω –∏ —É–≤–µ–ª–∏—á–∏—Ç—å –≤—Ä–µ–º—è —á—Ç–µ–Ω–∏—è, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–Ω—Ç–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π —Å–æ—á–µ—Ç–∞–µ—Ç –∏–Ω—Ç–µ—Ä–µ—Å, –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏ —ç–º–æ—Ü–∏–∏. –í–æ—Ç –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã:

–û–ü–¶–ò–ò –î–õ–Ø –í–´–ë–û–†–ê –ö–û–ù–¢–ï–ù–¢–ê (–í–´–ë–ï–†–ò –¢–û–õ–¨–ö–û 1 –û–ü–¶–ò–Æ –ò –ù–ê–ü–ò–®–ò –ö–û–ù–¢–ï–ù–¢ –ù–ê 3-5 –ú–ò–ù–£–¢ –ß–¢–ï–ù–ò–Ø)
1. –î–ª–∏–Ω–Ω—ã–µ, –Ω–æ —É–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–µ –∏—Å—Ç–æ—Ä–∏–∏
‚úî –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

–ó–∞—Ç—è–≥–∏–≤–∞—é—â–∏–π —Å—é–∂–µ—Ç —Å –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ–π —Ä–∞–∑–≤—è–∑–∫–æ–π.

–≠–ª–µ–º–µ–Ω—Ç—ã –¥–µ—Ç–µ–∫—Ç–∏–≤–∞, –º–∏—Å—Ç–∏–∫–∏ –∏–ª–∏ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è.

–ü—Ä–∏–º–µ—Ä:
"–ö–∞–∫ —Å–æ–≤–µ—Ç—Å–∫–∏–π —É—á—ë–Ω—ã–π –≤–∑–ª–æ–º–∞–ª –¥—Ä–µ–≤–Ω–∏–π —à–∏—Ñ—Ä... –∏ –Ω–∞—à—ë–ª –∫–ª–∞–¥, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–∫–∞–ª–∏ 300 –ª–µ—Ç. –í—Å—ë –Ω–∞—á–∞–ª–æ—Å—å —Å –ø—å—è–Ω–æ–≥–æ —Å–ø–æ—Ä–∞ –≤ –±–∞—Ä–µ!"

2. –ú–Ω–æ–≥–æ—Å–ª–æ–π–Ω—ã–µ —Å–ø–∏—Å–∫–∏ –∏ –ø–æ–¥–±–æ—Ä–∫–∏
‚úî –ü–æ—á–µ–º—É —Ä–∞–±–æ—Ç–∞–µ—Ç:

–ß–∏—Ç–∞—Ç–µ–ª—å –ª–∏—Å—Ç–∞–µ—Ç, –Ω–æ –Ω–µ —É—Ö–æ–¥–∏—Ç, –ø–æ–∫–∞ –Ω–µ –¥–æ–π–¥—ë—Ç –¥–æ –∫–æ–Ω—Ü–∞.

–ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–æ–∫–∞—Ü–∏–æ–Ω–Ω—ã–µ –ø—É–Ω–∫—Ç—ã, —á—Ç–æ–±—ã –≤—ã–∑—ã–≤–∞—Ç—å –æ–±—Å—É–∂–¥–µ–Ω–∏—è.

–§–æ—Ä–º–∞—Ç:
*"10 —Å–∞–º—ã—Ö –∞–±—Å—É—Ä–¥–Ω—ã—Ö –∑–∞–∫–æ–Ω–æ–≤ –ø—Ä–æ—à–ª–æ–≥–æ:

–í –í–∏–∫—Ç–æ—Ä–∏–∞–Ω—Å–∫–æ–π –ê–Ω–≥–ª–∏–∏ –∂–µ–Ω—â–∏–Ω–∞–º –∑–∞–ø—Ä–µ—â–∞–ª–æ—Å—å –µ—Å—Ç—å —à–æ–∫–æ–ª–∞–¥... –ø–æ—Ç–æ–º—É —á—Ç–æ —ç—Ç–æ '—Ä–∞–∑–∂–∏–≥–∞–µ—Ç —Å—Ç—Ä–∞—Å—Ç—å'.

–í –î—Ä–µ–≤–Ω–µ–º –†–∏–º–µ –ø–ª–∞–∫–∞—Ç—å –Ω–∞ –ø–æ—Ö–æ—Ä–æ–Ω–∞—Ö –ø–æ—Å—Ç–æ—Ä–æ–Ω–Ω–µ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞ –±—ã–ª–æ... –±–∏–∑–Ω–µ—Å–æ–º (–Ω–∞–Ω–∏–º–∞–ª–∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –ø–ª–∞–∫–∞–ª—å—â–∏—Ü).
...

–ó–∞–∫–æ–Ω, –∫–æ—Ç–æ—Ä—ã–π –¥–µ–π—Å—Ç–≤—É–µ—Ç –¥–æ —Å–∏—Ö –ø–æ—Ä (–≤—ã –Ω–µ –ø–æ–≤–µ—Ä–∏—Ç–µ!)"*

3. –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –æ–ø—Ä–æ—Å—ã –∏ —Ç–µ—Å—Ç—ã
‚úî –§–∏—à–∫–∞: –ß–∏—Ç–∞—Ç–µ–ª—å –¥–æ—Å–∫—Ä–æ–ª–ª–∏–≤–∞–µ—Ç –¥–æ –∫–æ–Ω—Ü–∞, —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç.
–ü—Ä–∏–º–µ—Ä:
"–ö–∞–∫–æ–π –≤—ã –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π –ø–µ—Ä—Å–æ–Ω–∞–∂?
–û—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ 5 –≤–æ–ø—Ä–æ—Å–æ–≤ ‚Üí —É–∑–Ω–∞–µ—Ç–µ, –±—ã–ª–∏ –±—ã –≤—ã –º—É–¥—Ä—ã–º –ø—Ä–∞–≤–∏—Ç–µ–ª–µ–º –∏–ª–∏ –±–µ–∑—É–º–Ω—ã–º —Ç–∏—Ä–∞–Ω–æ–º!"

4. "–†–∞–∑–æ–±–ª–∞—á–∞—é—â–∏–µ" —Å—Ç–∞—Ç—å–∏
‚úî –¶–µ–ø–ª—è–µ—Ç: –ß–∏—Ç–∞—Ç–µ–ª—å —Ö–æ—á–µ—Ç –¥–æ–π—Ç–∏ –¥–æ "—Ä–∞–∑–æ–±–ª–∞—á–µ–Ω–∏—è".
–¢–µ–º—ã:

"–ü–æ—á–µ–º—É –ù–∞–ø–æ–ª–µ–æ–Ω –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ –ø—Ä–æ–∏–≥—Ä–∞–ª –ø—Ä–∏ –í–∞—Ç–µ—Ä–ª–æ–æ (–Ω–µ –∏–∑-–∑–∞ —Ç–∞–∫—Ç–∏–∫–∏!)"

"–ú–∏—Ñ—ã –æ —Å—Ä–µ–¥–Ω–µ–≤–µ–∫–æ–≤—å–µ: —Ä—ã—Ü–∞—Ä–∏ –Ω–µ –ø–∞—Ö–ª–∏ —Ä–æ–∑–∞–º–∏ (–∞ —á–µ–º ‚Äî –≤–Ω—É—Ç—Ä–∏)"

5. –°–µ—Ä–∏–∏ –ø–æ—Å—Ç–æ–≤ —Å –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ–º
‚úî –ö–∞–∫ —É–¥–µ—Ä–∂–∞—Ç—å: –í –∫–æ–Ω—Ü–µ –ø–∏—à–µ—Ç–µ:
"–ó–∞–≤—Ç—Ä–∞ ‚Äî —á–∞—Å—Ç—å 2: –∫–∞–∫ —ç—Ç–∞ –∏—Å—Ç–æ—Ä–∏—è —Å–≤—è–∑–∞–Ω–∞ —Å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –ø–æ–ª–∏—Ç–∏–∫–∞–º–∏?"

6. –ö–æ–Ω—Ç–µ–Ω—Ç —Å "–≤–æ–≤–ª–µ–∫–∞—é—â–∏–º–∏" –≤–æ–ø—Ä–æ—Å–∞–º–∏
‚ùå –ü–ª–æ—Ö–æ: "–ö–∞–∫ –≤–∞–º —ç—Ç–∞ –∏—Å—Ç–æ—Ä–∏—è?"
‚úÖ –•–æ—Ä–æ—à–æ: "–ö–∞–∫ –¥—É–º–∞–µ—Ç–µ, —ç—Ç–æ—Ç –∑–∞–∫–æ–Ω –¥–µ–π—Å—Ç–≤–æ–≤–∞–ª –±—ã —Å–µ–≥–æ–¥–Ω—è? –ü–∏—à–∏—Ç–µ –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏!"

–í—ã–≤–æ–¥:
–õ—É—á—à–µ –≤—Å–µ–≥–æ —Ä–∞–±–æ—Ç–∞—é—Ç –∏—Å—Ç–æ—Ä–∏–∏ —Å –∏–Ω—Ç—Ä–∏–≥–æ–π, —Å–ø–∏—Å–∫–∏ —Å –Ω–µ–æ—á–µ–≤–∏–¥–Ω—ã–º–∏ —Ñ–∞–∫—Ç–∞–º–∏ –∏ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤. –î–æ–±–∞–≤–ª—è–π—Ç–µ –∫–∞—Ä—Ç–∏–Ω–∫–∏, –≥–∏—Ñ–∫–∏ –∏–ª–∏ –∫–æ—Ä–æ—Ç–∫–∏–µ –≤–∏–¥–µ–æ (–¥–æ 15 —Å–µ–∫), —á—Ç–æ–±—ã —Ä–∞–∑–±–∞–≤–ª—è—Ç—å —Ç–µ–∫—Å—Ç.

–ò–¥–µ–∞–ª—å–Ω—ã–π –ø–æ—Å—Ç = –∑–∞–≤–ª–µ–∫–∞—é—â–∏–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ + –∏–Ω—Ç—Ä–∏–≥–∞ –≤ –ø–µ—Ä–≤—ã—Ö —Å—Ç—Ä–æ–∫–∞—Ö + "–Ω–∞–∂–∏–≤–∫–∞" –≤ –∫–æ–Ω—Ü–µ (–æ–ø—Ä–æ—Å/–ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ). üé£

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–∫–∞–∑–∞–Ω–∏—è:
1. –¢–µ–∫—Å—Ç –¥–æ–ª–∂–µ–Ω –ª–µ–≥–∫–æ —á–∏—Ç–∞—Ç—å—Å—è, —É—á–∏—Ç—ã–≤–∞–π –ø—Ä–æ–±–µ–ª—ã. 
2. –ü—Ä–∏—Å—ã–ª–∞–π –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–æ–∫–æ–π –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä: –Æ–º–æ—Ä –¥–ª—è –≤—Å–µ—Ö, —Å–º–µ—è—Ç—å—Å—è - —ç—Ç–æ —Ö–æ—Ä–æ—à–æ) 
3. –ö–æ–Ω—Ç–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ –∂–∏–∑–Ω–µ–Ω–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö, –ª–∞–π—Ñ—Ö–∞–∫–∞—Ö, –Ω–µ–æ–±—ã—á–Ω—ã—Ö —Ñ–∞–∫—Ç–∞—Ö, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞–∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç –ª—é–¥–µ–π, –æ–Ω –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–º–µ—à–Ω–æ–π, –ª–∏–±–æ –ø–æ–∑–Ω–∞–≤–∞—Ç–µ–ª—å–Ω—ã–π. 
4. –û–ë–©–ê–Ø –î–õ–ò–ù–ê –ì–ï–ù–ï–†–ò–†–£–ï–ú–û–ì–û –¢–ï–ö–°–¢–ê –î–û–õ–ñ–ù–ê –ë–´–¢–¨ 1500-3000 —Å–∏–º–≤–æ–ª–æ–≤.
        """
    )
    try:
        result = generate_response(request)
        bot.send_message(CHAT_ID, result)
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è: {e}")

def run_scheduler():
    schedule.every(15).minutes.do(scheduled_task)
    while True:
        schedule.run_pending()
        time.sleep(1)

# –°—Ä–∞–∑—É –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
scheduled_task()

# –ó–∞–ø—É—Å–∫–∞–µ–º –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ—Ç–æ–∫–µ
threading.Thread(target=run_scheduler, daemon=True).start()

# –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞
bot.polling(none_stop=True)
